<!DOCTYPE html>
<html lang="en" xml:lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mental Health - FAQ</title>
  <meta name="description"
    content="Comprehensive FAQ about the Arduino Implementation for Mental Health Monitoring including hardware setup, code implementation, analysis, and data upload.">
  <meta name="keywords"
    content="mental health, arduino, monitoring system, sensors, MAX30102, GSR, BH1750, neural network, HRV, GitHub upload">
  <meta name="author" content="GALIH RIDHO UTOMO">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="Mental Health - FAQ">
  <meta property="og:description"
    content="Learn about the Arduino-based Mental Health Monitoring System - hardware setup, code implementation, analysis methods, and data upload features.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://4211421036.github.io/MentalHealth/faq">
  <meta property="og:image" content="https://4211421036.github.io/MentalHealth/logo/mh.png">
  <link rel="canonical" href="https://4211421036.github.io/MentalHealth/faq">
  <link href="https://4211421036.github.io/g4lihru/987654567.png" rel=icon type="image/x-icon">
  <link href="https://4211421036.github.io/g4lihru/987654567.png" rel="shortcut icon" type="image/x-icon">
  <link href="https://4211421036.github.io/g4lihru/987654567.png" rel="apple-touch-icon">
  <link href="https://4211421036.github.io/MentalHealth/manifest.webmanifest" rel="manifest">
  <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What sensors are used in this system?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The system uses three main sensors: 1) MAX30102 - Optical heart rate and blood oxygen sensor, 2) GSR Sensor - Galvanic Skin Response sensor for stress detection, 3) BH1750 - Ambient light sensor. These sensors work together to collect physiological data that can indicate mental health status."
                }
            },
            {
                "@type": "Question",
                "name": "How are the sensors connected to the microcontroller?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The sensors are connected as follows: MAX30102 and BH1750 use I2C communication (connected to SDA and SCL pins), and the GSR sensor is connected to analog pin 34. The code initializes these connections in the setup() function."
                }
            },
            {
                "@type": "Question",
                "name": "How does the heart rate detection work?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The MAX30102 sensor detects heart rate by measuring changes in blood volume using optical technology (PPG). The code implements: 1) IR LED shines light into the skin, 2) Photodetector measures reflected light, 3) Pulse detection algorithm identifies beats, 4) Beat-to-beat intervals are calculated for HRV. This is based on Shaffer et al. (2014) HRV measurement standards."
                }
            },
            {
                "@type": "Question",
                "name": "What is the purpose of the GSR moving average calculation?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The moving average calculation separates the GSR signal into two components: Tonic component (slow-changing baseline) and Phasic component (fast-changing responses). This is implemented with a 5-sample moving average window. The window size of 5 samples was chosen based on Boucsein's (2012) research on electrodermal activity measurement."
                }
            },
            {
                "@type": "Question",
                "name": "How is HRV (Heart Rate Variability) calculated?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "HRV is calculated using SDNN (Standard Deviation of NN intervals), which is a well-established metric in psychophysiology research (Castaldo et al., 2019). The code implements this by: 1) Storing the last 16 RR intervals (time between heartbeats), 2) Calculating the mean interval, 3) Computing the standard deviation of these intervals. HRV is an important indicator of autonomic nervous system activity and stress levels."
                }
            },
            {
                "@type": "Question",
                "name": "How does the neural network predict mental health status?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The system uses a neural network (defined in MentalHealthNN.h) that takes sensor inputs and outputs probabilities for four mental states: Normal, Stress, Anxiety, and Depression. The prediction happens in the detectMentalHealth() function. The neural network was likely trained on labeled physiological data from individuals with known mental health conditions."
                }
            },
            {
                "@type": "Question",
                "name": "What is the significance of the ambient light sensor?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The BH1750 light sensor measures ambient light levels which are important because: Light exposure affects circadian rhythms and mood (Golden et al., 2005), low light levels may correlate with depressive symptoms, and sudden light changes can indicate environmental stressors. The light data is read and included in the mental health analysis."
                }
            },
            {
                "@type": "Question",
                "name": "How does the GitHub data upload work?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The system uploads sensor data to GitHub repositories every 10 seconds using the GitHub API. The process includes: 1) Data is formatted as JSON documents, 2) Base64 encoded for GitHub API requirements, 3) Uploaded using HTTP PUT requests with authentication, 4) SHA hashes are tracked for version control. Four separate JSON files are maintained for each sensor type and the mental status."
                }
            }
        ]
    }
    </script>
  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #166088;
      --accent-color: #4fc3f7;
      --background-color: #f5f7fa;
      --text-color: #333;
      --light-text: #666;
      --border-color: #ddd;
      --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      --focus-outline: 3px solid var(--accent-color);
      --focus-outline-offset: 3px;
      --link-color: #0056b3;
      --link-hover-color: #003d82;
      --link-visited-color: #0000;
      --link-decoration: underline;
      --button-hover-bg: #135a96;
      --button-active-bg: #0d456e;
      --transition-time: 0.2s;
      --footer-bg: #f6f6f6;
      --nav-bg: #f8f9fa;
      --nav-hover: #e2e6ea;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      font-size: 16px;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ==================== Skip Link - Enhanced ==================== */
    .skip-link {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
      z-index: 9999;
      background: #0056b3;
      color: white;
      padding: 8px;
      border-radius: 4px;
    }

    .skip-link:focus {
      left: 10px;
      top: 10px;
      width: auto;
      height: auto;
      overflow: visible;
    }

    .skip-link:hover {
      background: var(--button-hover-bg);
      text-decoration: underline;
    }

    /* ==================== Typography ==================== */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      line-height: 1. margin-bottom: 0.75em;
      color: var(--secondary-color);
    }

    h1 {
      font-size: 2.2rem;
      margin-top: 0.5em;
    }

    h2 {
      font-size: 1.8rem;
    }

    p {
      margin-bottom: 1em;
    }

    /* ==================== Layout ==================== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
    }

    header img {
      width: 100%;  /* Ubah dari max-width menjadi width 100% */
      max-width: 600px;  /* Batasi lebar maksimum jika layar sangat besar */
      height: auto;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: var(--card-shadow);
    }

    .subtitle {
      color: var(--light-text);
      font-size: 1.1rem;
      margin-top: 0.5em;
    }

    /* ==================== FAQ Sections ==================== */
    .faq-section {
      margin-bottom: 40px;
    }

    .section-title {
      color: var(--primary-color);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-color);
    }

    .section-title i {
      color: var(--accent-color);
      font-size: 1.5rem;
    }

    .faq-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    /* ==================== FAQ Cards ==================== */
    .faq-card {
      background: white;
      border-radius: 8px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      transition: transform var(--transition-time) ease, box-shadow var(--transition-time) ease;
      border: 1px solid var(--border-color);
    }

    .faq-card:hover,
    .faq-card:focus-within {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .faq-question {
      padding: 20px;
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: none;
      width: 100%;
      text-align: left;
      transition: background-color var(--transition-time) ease;
    }

    .faq-question:hover {
      background-color: var(--button-hover-bg);
    }

    .faq-question:focus {
      outline: var(--focus-outline);
      outline-offset: var(--focus-outline-offset);
      background-color: var(--button-hover-bg);
    }

    .faq-question:active {
      background-color: var(--button-active-bg);
    }

    .faq-answer {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }

    .faq-card.active .faq-answer {
      padding: 20px;
      max-height: 1000px;
    }

    .faq-answer-content {
      padding-bottom: 10px;
    }

    /* ==================== Code Blocks ==================== */
    .code-block {
      background-color: #f0f0f0;
      border-radius: 5px;
      padding: 15px;
      margin: 15px 0;
      overflow-x: auto;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9rem;
      border-left: 4px solid var(--accent-color);
      position: relative;
    }

    .code-block::before {
      content: "Code";
      position: absolute;
      top: 0;
      right: 0;
      background: var(--accent-color);
      color: white;
      padding: 2px 8px;
      font-size: 0.8rem;
      border-radius: 0 0 0 5px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* ==================== Toggle Icon ==================== */
    .toggle-icon {
      transition: transform 0.3s ease;
      font-weight: bold;
      font-size: 1.3rem;
      min-width: 20px;
      text-align: center;
    }

    .faq-card.active .toggle-icon {
      transform: rotate(0deg);
    }

    /* ==================== References & Notes ==================== */
    .reference {
      font-size: 0.9rem;
      color: var(--light-text);
      margin-top: 10px;
      font-style: italic;
      padding-left: 15px;
      border-left: 3px solid var(--border-color);
    }

    .note {
      background-color: #fff8e1;
      padding: 15px;
      border-left: 4px solid #ffc107;
      margin: 15px 0;
      border-radius: 0 4px 4px 0;
      position: relative;
    }

    .note strong {
      color: #ff9800;
    }

    /* ==================== Links & Buttons ==================== */
    a {
      color: var(--link-color);
      text-decoration: var(--link-decoration);
      font-weight: bold;
      transition: color var(--transition-time) ease, background-color var(--transition-time) ease;
    }

    a:hover,
    a:focus {
      color: var(--link-hover-color);
      text-decoration: underline;
      outline: none;
    }

    a:visited {
      color: var(--link-visited-color);
    }

    button {
      cursor: pointer;
      transition: all var(--transition-time) ease;
    }

    /* ==================== Lists ==================== */
    ol,
    ul {
      margin-bottom: 1em;
      padding-left: 2em;
    }

    li {
      margin-bottom: 0.5em;
    }

    /* ==================== Navigation ==================== */
    #faq-navigation {
      background-color: var(--nav-bg);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
    }

    #faq-navigation ul {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      list-style: none;
      padding-left: 0;
    }

    #faq-navigation li {
      margin-bottom: 0;
    }

    #faq-navigation a {
      display: block;
      padding: 8px 15px;
      background-color: white;
      border-radius: 4px;
      text-decoration: none;
      transition: all var(--transition-time) ease;
      border: 1px solid var(--border-color);
    }

    #faq-navigation a:hover,
    #faq-navigation a:focus {
      background-color: var(--nav-hover);
      color: var(--link-hover-color);
      text-decoration: none;
    }

    /* ==================== Footer ==================== */
    footer {
      background-color: var(--footer-bg);
      padding: 20px;
      text-align: center;
      margin-top: 40px;
      border-top: 1px solid var(--border-color);
    }

    footer p {
      margin-bottom: 0.5em;
    }

    footer a {
      color: var(--primary-color);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* ==================== Focus Styles ==================== */
    a:focus,
    button:focus,
    input:focus,
    select:focus,
    textarea:focus,
    [tabindex="0"]:focus {
      outline: var(--focus-outline);
      outline-offset: var(--focus-outline-offset);
      position: relative;
    }

    /* ==================== Media Queries ==================== */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    @media (max-width: 768px) {
      html {
        font-size: 14px;
      }

      .container {
        padding: 15px;
      }

      h1 {
        font-size: 1.8rem;
      }

      h2 {
        font-size: 1.5rem;
      }

      .faq-question {
        font-size: 1.1rem;
        padding: 15px;
      }

      .faq-answer {
        padding: 0 15px;
      }

      .faq-card.active .faq-answer {
        padding: 15px;
      }

      #faq-navigation ul {
        gap: 10px;
      }

      header img {
        max-width: 100%;
      }
    }

    @media (max-width: 480px) {
      html {
        font-size: 13px;
      }

      .section-title {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }

      .code-block {
        padding: 10px;
        font-size: 0.8rem;
      }
    }

    /* ==================== Print Styles ==================== */
    @media print {

      .skip-link,
      .toggle-icon,
      #faq-navigation {
        display: none;
      }

      body {
        background-color: white;
        color: black;
        font-size: 12pt;
      }

      .faq-card {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
      }

      .faq-question {
        background-color: white !important;
        color: black !important;
        padding: 10px !important;
      }

      .faq-answer {
        max-height: none !important;
        display: block !important;
        padding: 10px !important;
      }

      footer {
        border-top: 1px solid #ddd;
      }
    }

    /* ==================== High Contrast Mode ==================== */
    @media screen and (-ms-high-contrast: active) {
      :root {
        --primary-color: windowText;
        --background-color: window;
        --text-color: windowText;
        --focus-outline: 2px solid highlight;
      }

      .faq-question {
        -ms-high-contrast-adjust: none;
        background-color: windowText;
        color: window;
      }

      .skip-link {
        border: 2px solid highlight;
      }

      .faq-card {
        border: 2px solid windowText;
      }
    }

    /* ==================== Visually Hidden Utility Class ==================== */
    .visually-hidden {
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Style untuk input field dan label */
    /* Base Styling */
    .mhc-container {
      position: fixed;
      background: white;
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* Mobile positioning and sizing */
    @media (max-width: 768px) {
      .mhc-container {
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        border-radius: 24px 24px 0 0;
      }

      /* Minimized State - Only Input visible */
      .mhc-container.minimized {
        height: 60px;
      }

      /* Partial State - 30% height */
      .mhc-container.partial {
        height: 33vh;
        max-height: 300px;
      }

      /* Expanded State - Full height */
      .mhc-container.expanded {
        height: 85vh;
      }
    }

    /* Desktop positioning and sizing */
    @media (min-width: 769px) {
      .mhc-container {
        bottom: 10px;
        right: 10px;
        width: 360px;
        border-radius: 12px;
        max-height: calc(100vh - 20px);
      }

      .mhc-container.desktop {
        height: 33vh;
        min-height: 300px;
        max-height: 450px;
      }

      /* On desktop, minimized isn't actually used but defined for completeness */
      .mhc-container.desktop.minimized {
        height: 30vh;
        min-height: 300px;
      }

      /* On desktop, expanded goes taller but not full screen */
      .mhc-container.desktop.expanded {
        height: 70vh;
        max-height: 700px;
      }
    }

    .mhc-header {
      padding: 16px;
      background: linear-gradient(135deg, #4a6fa5, #3a5a8a);
      color: white;
      text-align: center;
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
      user-select: none;
    }

    .mhc-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
      transition: opacity 0.2s;
      color: white;
    }

    .mhc-swipe-handle {
      width: 40px;
      height: 4px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 2px;
      margin: 0 auto 8px;
      cursor: grab;
    }

    .mhc-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: #f8f9fa;
      display: none;
      /* Initially hidden in minimized state */
    }

    .mhc-message {
      margin-bottom: 12px;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.4;
      font-size: 14px;
      animation: fadeIn 0.3s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-message {
      background: #4a6fa5;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .bot-message {
      background: #e9ecef;
      color: #212529;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }

    .mhc-input-container {
      display: flex;
      padding: 12px;
      border-top: 1px solid #e9ecef;
      background: white;
      flex-shrink: 0;
      box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.05);
      position: relative;
      z-index:
    }

    .mhc-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e9ecef;
      border-radius: 24px;
      outline: none;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .mhc-input:focus {
      border-color: #4a6fa5;
      box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
    }

    .mhc-input[data-placeholder]:empty::before {
      content: attr(data-placeholder);
      color: #999;
      pointer-events: none;
    }

    .mhc-input[contenteditable="true"]:empty::before {
      content: attr(data-placeholder);
      color: #999;
    }

    .mhc-input-label {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Untuk screen reader tetap bisa mengakses label */
    .mhc-input[aria-labelledby] {
      -ms-aria-flowto: mhc-input-label;
    }

    .mhc-send-btn {
      margin-left: 10px;
      width: 44px;
      height: 44px;
      background: #4a6fa5;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .mhc-send-btn:hover {
      background: #3a5a8a;
      transform: scale(1.05);
    }

    .mhc-quick-replies {
      display: none;
      /* Initially hidden in minimized state */
      flex-wrap: wrap;
      padding: 8px 12px;
      gap: 8px;
      background: white;
      border-top: 1px solid #e9ecef;
    }

    .mhc-quick-btn {
      padding: 8px 12px;
      background: #e9ecef;
      border: none;
      border-radius: 16px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .mhc-quick-btn:hover {
      background: #dee2e6;
    }

    .mhc-meter-label {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mhc-visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .mhc-input-label {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Iframe container styling */
    .mhc-iframe-container {
      position: relative;
      width: 100%;
      height: 300px;
      margin-top: 10px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #ddd;
    }

    .mhc-iframe-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Pop-out button styling */
    .mhc-pop-out-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 30px;
      height: 30px;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .mhc-pop-out-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</head>

<body role="document" id="page-body">
  <a href="#main-content" class="skip-link" id="skip-to-content" role="link" accesskey="s">Skip to main content</a>

  <div class="container" id="main-container" role="presentation">
    <header role="banner" id="page-header">
      <h1 id="main-title" role="heading" aria-level="1">Mental Health Monitoring System</h1>
      <img src="logo/mh.png" alt="logo">
      <p class="subtitle" id="subtitle" role="text">Frequently Asked Questions about the Arduino Implementation</p>
    </header>

    <main id="main-content" role="main">
      <nav id="faq-navigation" role="navigation" aria-label="FAQ Categories">
        <ul class="visually-hidden" role="list">
          <li id="nav-item-1" role="listitem"><a href="#hardware-heading" id="nav-link-1" role="link">Hardware Setup</a>
          </li>
          <li id="nav-item-2" role="listitem"><a href="#code-heading" id="nav-link-2" role="link">Code
              Implementation</a></li>
          <li id="nav-item-3" role="listitem"><a href="#analysis-heading" id="nav-link-3" role="link">Mental Health
              Analysis</a></li>
          <li id="nav-item-4" role="listitem"><a href="#upload-heading" id="nav-link-4" role="link">Data Upload</a></li>
        </ul>
      </nav>

      <section class="faq-section" aria-labelledby="hardware-heading" id="hardware-section" role="region">
        <h2 id="hardware-heading" class="section-title" role="heading" aria-level="2">
          <span aria-hidden="true" class="fas fa-microchip" id="hardware-icon" role="presentation"></span>
          Hardware Setup
        </h2>
        <div class="faq-container" id="hardware-container" role="list">

          <div class="faq-card" id="faq-card-1" role="listitem">
            <button id="faq-question-1" class="faq-question" aria-expanded="false" aria-controls="faq-answer-1"
              role="button">
              What sensors are used in this system?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-1" role="presentation">+</span>
            </button>
            <div id="faq-answer-1" class="faq-answer" role="region" aria-labelledby="faq-question-1">
              <div class="faq-answer-content" id="answer-content-1" role="text">
                <p id="sensors-intro" role="text">The system uses three main sensors:</p>
                <ol id="sensors-list" role="list">
                  <li id="sensor-1" role="listitem"><strong id="sensor-1-name" role="text">MAX30102</strong> - Optical
                    heart rate and blood oxygen sensor</li>
                  <li id="sensor-2" role="listitem"><strong id="sensor-2-name" role="text">GSR Sensor</strong> -
                    Galvanic Skin Response sensor for stress detection</li>
                  <li id="sensor-3" role="listitem"><strong id="sensor-3-name" role="text">BH1750</strong> - Ambient
                    light sensor</li>
                </ol>
                <p id="sensors-description" role="text">These sensors work together to collect physiological data that
                  can indicate mental health status.</p>
                <div class="code-block" id="sensors-code" role="code">
                  <pre id="sensors-code-pre" role="presentation"><code id="sensors-code-content" role="code">// Sensor Objects in the code
MAX30105 particleSensor;  // MAX30102 sensor object
BH1750 lightMeter;       // BH1750 light sensor
const int GSR_PIN = 34;  // GSR sensor pin</code></pre>
                </div>
              </div>
            </div>
          </div>

          <div class="faq-card" id="faq-card-2" role="listitem">
            <button id="faq-question-2" class="faq-question" aria-expanded="false" aria-controls="faq-answer-2"
              role="button">
              How are the sensors connected to the microcontroller?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-2" role="presentation">+</span>
            </button>
            <div id="faq-answer-2" class="faq-answer" role="region" aria-labelledby="faq-question-2">
              <div class="faq-answer-content" id="answer-content-2" role="text">
                <p id="connection-intro" role="text">The sensors are connected as follows:</p>
                <ul id="connection-list" role="list">
                  <li id="connection-1" role="listitem">MAX30102 and BH1750 use I2C communication (connected to SDA and
                    SCL pins)</li>
                  <li id="connection-2" role="listitem">GSR sensor is connected to analog pin 34</li>
                </ul>
                <p id="connection-code-intro" role="text">The code initializes these connections in the <code
                    id="setup-function" role="code">setup()</code> function:</p>
                <div class="code-block" id="connection-code" role="code">
                  <pre id="connection-code-pre" role="presentation"><code id="connection-code-content" role="code">void setup() {
  Wire.begin();  // Initialize I2C
  particleSensor.begin(Wire, I2C_SPEED_FAST); // MAX30102
  lightMeter.begin(); // BH1750
  // GSR is analog so only needs pin declaration
}</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="faq-section" aria-labelledby="code-heading" id="code-section" role="region">
        <h2 id="code-heading" class="section-title" role="heading" aria-level="2">
          <span aria-hidden="true" class="fas fa-code" id="code-icon" role="presentation"></span>
          Code Implementation
        </h2>
        <div class="faq-container" id="code-container" role="list">

          <div class="faq-card" id="faq-card-3" role="listitem">
            <button id="faq-question-3" class="faq-question" aria-expanded="false" aria-controls="faq-answer-3"
              role="button">
              How does the heart rate detection work?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-3" role="presentation">+</span>
            </button>
            <div id="faq-answer-3" class="faq-answer" role="region" aria-labelledby="faq-question-3">
              <div class="faq-answer-content" id="answer-content-3" role="text">
                <p id="hr-intro" role="text">The MAX30102 sensor detects heart rate by measuring changes in blood volume
                  using optical technology (PPG). The code implements:</p>
                <ol id="hr-steps" role="list">
                  <li id="hr-step-1" role="listitem">IR LED shines light into the skin</li>
                  <li id="hr-step-2" role="listitem">Photodetector measures reflected light</li>
                  <li id="hr-step-3" role="listitem">Pulse detection algorithm identifies beats</li>
                  <li id="hr-step-4" role="listitem">Beat-to-beat intervals are calculated for HRV</li>
                </ol>
                <div class="code-block" id="hr-code" role="code">
                  <pre id="hr-code-pre" role="presentation"><code id="hr-code-content" role="code">if(irValue > 50000) {  // Finger detected
  if(checkForBeat(irValue)) {
    long delta = millis() - lastBeat;
    lastBeat = millis();
    beatsPerMinute = 60000.0 / delta;
  }
}</code></pre>
                </div>
                <p class="reference" id="hr-reference" role="text">Based on Shaffer et al. (2014) HRV measurement
                  standards</p>
              </div>
            </div>
          </div>

          <div class="faq-card" id="faq-card-4" role="listitem">
            <button id="faq-question-4" class="faq-question" aria-expanded="false" aria-controls="faq-answer-4"
              role="button">
              What is the purpose of the GSR moving average calculation?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-4" role="presentation">+</span>
            </button>
            <div id="faq-answer-4" class="faq-answer" role="region" aria-labelledby="faq-question-4">
              <div class="faq-answer-content" id="answer-content-4" role="text">
                <p id="gsr-intro" role="text">The moving average calculation separates the GSR signal into two
                  components:</p>
                <ul id="gsr-components" role="list">
                  <li id="gsr-component-1" role="listitem"><strong id="tonic-label" role="text">Tonic component</strong>
                    (slow-changing baseline)</li>
                  <li id="gsr-component-2" role="listitem"><strong id="phasic-label" role="text">Phasic
                      component</strong> (fast-changing responses)</li>
                </ul>
                <p id="gsr-window" role="text">This is implemented with a 5-sample moving average window:</p>
                <div class="code-block" id="gsr-code" role="code">
                  <pre id="gsr-code-pre" role="presentation"><code id="gsr-code-content" role="code">// Moving average for EDA tonic (Boucsein, 2012)
float edaMovingAverage(float newVal) {
  eda_buffer[buffer_index] = newVal;
  buffer_index = (buffer_index + 1) % WINDOW_SIZE;
  float sum = 0;
  for(int i=0; i&lt;WINDOW_SIZE; i++) sum += eda_buffer[i];
  return sum/WINDOW_SIZE;
}</code></pre>
                </div>
                <div class="note" id="gsr-note" role="note">
                  <strong id="note-label" role="text">Note:</strong> The window size of 5 samples was chosen based on
                  Boucsein's (2012) research on electrodermal activity measurement.
                </div>
              </div>
            </div>
          </div>

          <div class="faq-card" id="faq-card-5" role="listitem">
            <button id="faq-question-5" class="faq-question" aria-expanded="false" aria-controls="faq-answer-5"
              role="button">
              How is HRV (Heart Rate Variability) calculated?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-5" role="presentation">+</span>
            </button>
            <div id="faq-answer-5" class="faq-answer" role="region" aria-labelledby="faq-question-5">
              <div class="faq-answer-content" id="answer-content-5" role="text">
                <p id="hrv-intro" role="text">HRV is calculated using SDNN (Standard Deviation of NN intervals), which
                  is a well-established metric in psychophysiology research (Castaldo et al., 2019).</p>
                <p id="hrv-explanation" role="text">The code implements this by:</p>
                <ol id="hrv-steps" role="list">
                  <li id="hrv-step-1" role="listitem">Storing the last 16 RR intervals (time between heartbeats)</li>
                  <li id="hrv-step-2" role="listitem">Calculating the mean interval</li>
                  <li id="hrv-step-3" role="listitem">Computing the standard deviation of these intervals</li>
                </ol>
                <div class="code-block" id="hrv-code" role="code">
                  <pre id="hrv-code-pre" role="presentation"><code id="hrv-code-content" role="code">// Calculate SDNN (Standard Deviation of NN intervals)
float calculateSDNN() {
  float mean = 0.0f;
  for (int i = 0; i &lt; RR_BUFFER_SIZE; i++) {
    mean += rrIntervals[i];
  }
  mean /= RR_BUFFER_SIZE;
  // ... variance calculation ...
  return sqrt(variance);
}</code></pre>
                </div>
                <p id="hrv-conclusion" role="text">HRV is an important indicator of autonomic nervous system activity
                  and stress levels.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="faq-section" aria-labelledby="analysis-heading" id="analysis-section" role="region">
        <h2 id="analysis-heading" class="section-title" role="heading" aria-level="2">
          <span aria-hidden="true" class="fas fa-brain" id="analysis-icon" role="presentation"></span>
          Mental Health Analysis
        </h2>
        <div class="faq-container" id="analysis-container" role="list">

          <div class="faq-card" id="faq-card-6" role="listitem">
            <button id="faq-question-6" class="faq-question" aria-expanded="false" aria-controls="faq-answer-6"
              role="button">
              How does the neural network predict mental health status?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-6" role="presentation">+</span>
            </button>
            <div id="faq-answer-6" class="faq-answer" role="region" aria-labelledby="faq-question-6">
              <div class="faq-answer-content" id="answer-content-6" role="text">
                <p id="nn-intro" role="text">The system uses a neural network (defined in MentalHealthNN.h) that takes
                  sensor inputs and outputs probabilities for four mental states:</p>
                <ol id="nn-states" role="list">
                  <li id="nn-state-1" role="listitem">Normal</li>
                  <li id="nn-state-2" role="listitem">Stress</li>
                  <li id="nn-state-3" role="listitem">Anxiety</li>
                  <li id="nn-state-4" role="listitem">Depression</li>
                </ol>
                <p id="nn-function" role="text">The prediction happens in the <code id="detect-function"
                    role="code">detectMentalHealth()</code> function:</p>
                <div class="code-block" id="nn-code" role="code">
                  <pre id="nn-code-pre" role="presentation"><code id="nn-code-content" role="code">void detectMentalHealth(float edaTonic, float edaPhasic, float bpm, float hrv, float lux, 
    MentalHealthStatus& status, float* probabilities) {
  // Get prediction from neural network
  status = mentalHealth.predict(edaTonic, edaPhasic, bpm, hrv, lux);
  // Get probabilities for each class
  mentalHealth.getPredictionProbabilities(edaTonic, edaPhasic, bpm, hrv, lux, probabilities);
}</code></pre>
                </div>
                <p id="nn-training" role="text">The neural network was likely trained on labeled physiological data from
                  individuals with known mental health conditions.</p>
              </div>
            </div>
          </div>

          <div class="faq-card" id="faq-card-7" role="listitem">
            <button id="faq-question-7" class="faq-question" aria-expanded="false" aria-controls="faq-answer-7"
              role="button">
              What is the significance of the ambient light sensor?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-7" role="presentation">+</span>
            </button>
            <div id="faq-answer-7" class="faq-answer" role="region" aria-labelledby="faq-question-7">
              <div class="faq-answer-content" id="answer-content-7" role="text">
                <p id="light-intro" role="text">The BH1750 light sensor measures ambient light levels which are
                  important because:</p>
                <ul id="light-importance" role="list">
                  <li id="light-importance-1" role="listitem">Light exposure affects circadian rhythms and mood (Golden
                    et al., 2005)</li>
                  <li id="light-importance-2" role="listitem">Low light levels may correlate with depressive symptoms
                  </li>
                  <li id="light-importance-3" role="listitem">Sudden light changes can indicate environmental stressors
                  </li>
                </ul>
                <p id="light-code-intro" role="text">The light data is read and included in the mental health analysis:
                </p>
                <div class="code-block" id="light-code" role="code">
                  <pre id="light-code-pre" role="presentation"><code id="light-code-content" role="code">// Read BH1750 ambient light sensor
float lux = lightMeter.readLightLevel();

// Included in neural network input
detectMentalHealth(..., lux, ...);</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="faq-section" aria-labelledby="upload-heading" id="upload-section" role="region">
        <h2 id="upload-heading" class="section-title" role="heading" aria-level="2">
          <span aria-hidden="true" class="fas fa-cloud-upload-alt" id="upload-icon" role="presentation"></span>
          Data Upload
        </h2>
        <div class="faq-container" id="upload-container" role="list">

          <div class="faq-card" id="faq-card-8" role="listitem">
            <button id="faq-question-8" class="faq-question" aria-expanded="false" aria-controls="faq-answer-8"
              role="button">
              How does the GitHub data upload work?
              <span class="toggle-icon" aria-hidden="true" id="toggle-icon-8" role="presentation">+</span>
            </button>
            <div id="faq-answer-8" class="faq-answer" role="region" aria-labelledby="faq-question-8">
              <div class="faq-answer-content" id="answer-content-8" role="text">
                <p id="github-intro" role="text">The system uploads sensor data to GitHub repositories every 10 seconds
                  using the GitHub API:</p>
                <ol id="github-steps" role="list">
                  <li id="github-step-1" role="listitem">Data is formatted as JSON documents</li>
                  <li id="github-step-2" role="listitem">Base64 encoded for GitHub API requirements</li>
                  <li id="github-step-3" role="listitem">Uploaded using HTTP PUT requests with authentication</li>
                  <li id="github-step-4" role="listitem">SHA hashes are tracked for version control</li>
                </ol>
                <div class="code-block" id="github-code" role="code">
                  <pre id="github-code-pre" role="presentation"><code id="github-code-content" role="code">// Example of GitHub upload function
void uploadToGitHub(DynamicJsonDocument doc, const char* url, String& lastSHA) {
  HTTPClient http;
  http.begin(url);
  http.addHeader("Content-Type", "application/json");
  http.addHeader("Authorization", token);

  String jsonStr;
  serializeJson(doc, jsonStr);
  String encodedData = base64::encode(jsonStr);

  String payload = "{\"message\":\"Update data\",\"content\":\"" + 
      encodedData + "\",\"sha\":\"" + lastSHA + "\"}";

  int httpCode = http.PUT(payload);
  // ... handle response ...
}</code></pre>
                </div>
                <p id="github-conclusion" role="text">Four separate JSON files are maintained for each sensor type and
                  the mental status.</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer role="contentinfo" id="page-footer">
      <p id="version-info" role="text">Mental Health Monitoring System - Version 1.0.2</p>
      <p id="contact-info">For questions about Mental Health, please contact <a
          href="mailto:g4lihru@students.unnes.ac.id" id="support-email" title="Email">g4lihru@students.unnes.ac.id</a>
      </p>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize all FAQ cards
      const faqCards = document.querySelectorAll('.faq-card');

      faqCards.forEach(card => {
        const question = card.querySelector('.faq-question');
        const answerId = question.getAttribute('aria-controls');
        const answer = document.getElementById(answerId);

        // Click handler
        question.addEventListener('click', () => {
          const isExpanded = question.getAttribute('aria-expanded') === 'true';
          question.setAttribute('aria-expanded', !isExpanded);
          card.classList.toggle('active');

          // Update the toggle icon
          const icon = question.querySelector('.toggle-icon');
          icon.textContent = isExpanded ? '+' : '-';
        });

        // Keyboard support
        question.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            question.click();
          }
        });
      });

      // Focus management for better keyboard navigation
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Tab') {
          const focusableElements = document.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          );
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey && document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          } else if (!e.shiftKey && document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      });
    });
  </script>
  <script>
    class MentalHealthChatbot {
      constructor() {
        this.body = document.body;
        // Training data for the AI model
        this.trainingData = [
          { input: "depression", output: { category: "depression", response: "depression" } },
          { input: "I feel sad", output: { category: "depression", response: "depression" } },
          { input: "anxiety", output: { category: "anxiety", response: "anxiety" } },
          { input: "I'm always worried", output: { category: "anxiety", response: "anxiety" } },
          { input: "stress", output: { category: "stress", response: "stress" } },
          { input: "I'm so stressed", output: { category: "stress", response: "stress" } },
          { input: "how to relax", output: { category: "self_care", response: "self_care" } },
          { input: "self care", output: { category: "self_care", response: "self_care" } },
          { input: "selfcare", output: { category: "self_care", response: "self_care" } },
          { input: "self-care", output: { category: "self_care", response: "self_care" } },
          { input: "relaxation", output: { category: "self_care", response: "self_care" } },
          { input: "how to take care of myself", output: { category: "self_care", response: "self_care" } },
          { input: "help", output: { category: "help", response: "help" } },
          { input: "I need help", output: { category: "help", response: "help" } },
          { input: "sensors", output: { category: "sensors", response: "sensors" } },
          { input: "how does this work", output: { category: "sensors", response: "sensors" } }
        ];

        // FAQ Data with detailed responses
        this.faqData = {
          "depression": {
            responses: [
              "Common signs of depression include persistent sadness, loss of interest in activities, changes in sleep/appetite, fatigue, and difficulty concentrating.",
              "Our system monitors physiological indicators like reduced reactivity and light sensitivity that may correlate with depressive states."
            ],
            resources: "https://www.instagram.com/peercounselor.unnes"
          },
          "anxiety": {
            responses: [
              "Anxiety often manifests as excessive worry, restlessness, increased heart rate, sweating, and rapid breathing.",
              "Our sensors detect elevated GSR responses and irregular heart rhythms that may indicate anxiety."
            ],
            resources: "https://www.nimh.nih.gov/health/topics/anxiety-disorders"
          },
          "stress": {
            responses: [
              "Stress symptoms include irritability, headaches, muscle tension, sleep problems, and changes in heart rate variability.",
              "Our system identifies stress patterns through higher GSR and reduced HRV measurements."
            ],
            resources: "https://www.cdc.gov/mentalhealth/stress-coping/index.html"
          },
          "self_care": {
            responses: [
              "Self-care is essential for mental wellbeing. Try these techniques:",
              "1. Take short breaks during work",
              "2. Practice deep breathing exercises",
              "3. Maintain a regular sleep schedule",
              "4. Engage in physical activity you enjoy"
            ],
            resources: "https://www.mentalhealth.org.uk/publications/how-to-mental-health"
          },
          "help": {
            responses: [
              "You can contact mental health professionals through our partner network.",
              "Based on your current metrics, I recommend reaching out to:"
            ],
            resources: "https://www.instagram.com/peercounselor.unnes"
          },
          "sensors": {
            responses: [
              "Our system uses multiple sensors:",
              "1. GSR measures skin conductance (emotional arousal)",
              "2. Heart rate sensor tracks cardiovascular activity",
              "3. HRV assesses autonomic nervous system balance",
              "4. Light sensor monitors environmental factors affecting mood"
            ],
            resources: ""
          }
        };

        // UI States
        this.states = {
          MINIMIZED: 'minimized',    // Only input visible
          PARTIAL: 'partial',        // 30% height with last response
          EXPANDED: 'expanded'       // Full screen
        };
        this.currentState = this.states.MINIMIZED;
        this.isMobile = window.innerWidth <= 768;

        // Initialize
        this.initializeModel();
        this.initializeUI();
        this.setupEventListeners();
      }

      initializeModel() {
        // Simple prediction model
        this.model = {
          predict: (input) => {
            const lowerInput = input.toLowerCase();
            let bestMatch = { score: 0, output: null };

            this.trainingData.forEach(example => {
              const score = this.similarity(lowerInput, example.input.toLowerCase());
              if (score > bestMatch.score) {
                bestMatch = { score, output: example.output };
              }
            });

            return bestMatch.score > 0.3 ? bestMatch.output : { category: "unknown", response: "unknown" };
          }
        };
      }

      similarity(s1, s2) {
        // Normalisasi string sebelum dibandingkan
        const normalize = str => str.toLowerCase()
          .replace(/-/g, ' ')
          .replace(/_/g, ' ')
          .trim();

        const words1 = normalize(s1).split(' ');
        const words2 = normalize(s2).split(' ');

        const intersection = words1.filter(word => words2.includes(word));
        return intersection.length / Math.max(words1.length, words2.length);
      }

      initializeUI() {
        // Main container - Different positioning for mobile vs desktop
        this.liveRegion = document.createElement('div');
        this.liveRegion.setAttribute('aria-live', 'polite');
        this.liveRegion.setAttribute('aria-atomic', 'true');
        this.liveRegion.className = 'sr-only';


        this.chatContainer = document.createElement('div');
        this.chatContainer.className = 'mhc-container minimized';
        this.chatContainer.setAttribute('role', 'dialog');
        this.chatContainer.setAttribute('aria-labelledby', 'mhc-title');
        this.chatContainer.setAttribute('aria-describedby', 'mhc-instructions'); // Tambahkan deskripsi
        this.chatContainer.setAttribute('aria-modal', 'true');
        this.chatContainer.appendChild(this.liveRegion);

        // Header with swipe handle
        this.header = document.createElement('div');
        this.header.className = 'mhc-header';
        this.header.innerHTML = `
  <div class="mhc-swipe-handle" aria-hidden="true"></div>
  <h3 id="mhc-title" lang="id">MH AI</h3>
`;

        // Message area
        this.messageArea = document.createElement('div');
        this.messageArea.className = 'mhc-messages';
        this.messageArea.setAttribute('aria-live', 'polite');
        this.messageArea.setAttribute('role', 'log');
        this.messageArea.setAttribute('aria-label', 'Conversation messages');

        // Input area (always visible)
        this.inputContainer = document.createElement('div');
        this.inputContainer.className = 'mhc-input-container';

        // Input Field dengan proper accessible name
        const inputWrapper = document.createElement('div');
        inputWrapper.className = 'mhc-input-wrapper';

        // Label yang sudah dimodifikasi
        const inputLabel = document.createElement('label');
        inputLabel.setAttribute('for', 'mhc-user-input');
        inputLabel.id = 'mhc-input-label';
        inputLabel.className = 'mhc-input-label';
        inputLabel.textContent = 'Message input';

        // Create the textbox div
        this.inputField = document.createElement('div');
        this.inputField.className = 'mhc-input';
        this.inputField.id = 'mhc-user-input';
        this.inputField.setAttribute('role', 'textbox');
        this.inputField.setAttribute('aria-required', 'true');
        this.inputField.setAttribute('aria-labelledby', 'mhc-input-label');
        this.inputField.setAttribute('contenteditable', 'true');
        this.inputField.setAttribute('aria-placeholder', 'Ask about mental health...');
        this.inputField.dataset.placeholder = 'Ask about mental health...';

        // Tambahkan event listeners untuk placeholder behavior
        this.inputField.addEventListener('focus', () => {
          if (this.inputField.textContent === this.inputField.dataset.placeholder) {
            this.inputField.textContent = '';
          }
        });

        this.inputField.addEventListener('blur', () => {
          if (this.inputField.textContent === '') {
            this.inputField.textContent = this.inputField.dataset.placeholder;
          }
        });

        this.sendButton = document.createElement('input');
        this.sendButton.className = 'mhc-send-btn';
        this.sendButton.setAttribute('type', 'button');
        this.sendButton.setAttribute('value', '');  // Unicode right arrow
        this.sendButton.setAttribute('aria-label', 'Send message');

        // Tooltip untuk screen reader
        this.sendTooltip = document.createElement('span');
        this.sendTooltip.className = 'mhc-visually-hidden';
        this.sendTooltip.textContent = 'Click to send your message';
        this.sendTooltip.setAttribute('role', 'tooltip');
        this.sendButton.appendChild(this.sendTooltip);

        this.inputContainer.appendChild(inputLabel);
        this.inputContainer.appendChild(this.inputField);
        this.inputContainer.appendChild(this.sendButton);

        // Quick replies - Converting to an accessible menu pattern
        this.quickReplies = document.createElement('div');
        this.quickReplies.className = 'mhc-quick-replies';
        this.quickReplies.setAttribute('role', 'menu');
        this.quickReplies.setAttribute('aria-label', 'Quick reply options');
        this.quickReplies.setAttribute('aria-orientation', 'horizontal'); // Untuk menu horizontal

        // Menu items dengan proper aksesibilitas
        ['Depression', 'Anxiety', 'Stress', 'Self Care'].forEach(topic => {
          const menuItem = document.createElement('div');
          menuItem.className = 'mhc-quick-btn';
          menuItem.textContent = topic;
          menuItem.dataset.topic = topic.toLowerCase().replace(' ', '_');
          menuItem.setAttribute('role', 'menuitem');
          menuItem.setAttribute('aria-label', `Quick reply about ${topic}`);
          menuItem.setAttribute('tabindex', '-1');
          menuItem.setAttribute('aria-posinset', (['Depression', 'Anxiety', 'Stress', 'Self Care'].indexOf(topic) + 1).toString());
          menuItem.setAttribute('aria-setsize', '4');
          this.quickReplies.appendChild(menuItem);
        });
        // Progress bar container (initially hidden)
        this.progressContainer = document.createElement('div');
        this.progressContainer.className = 'mhc-progress-container';
        this.progressContainer.style.display = 'block';

        // Creating a label for the progress bar
        const progressBarLabel = document.createElement('span');
        progressBarLabel.className = 'mhc-visually-hidden';
        progressBarLabel.id = 'mhc-progress-label';
        progressBarLabel.textContent = 'Message sending progress';

        this.progressBar = document.createElement('div');
        this.progressBar.className = 'mhc-progress-bar';
        this.progressBar.setAttribute('role', 'progressbar');
        this.progressBar.setAttribute('aria-valuemin', '0');
        this.progressBar.setAttribute('aria-valuemax', '100');
        this.progressBar.setAttribute('aria-valuenow', '0');
        this.progressBar.setAttribute('aria-labelledby', 'mhc-progress-label');

        this.progressContainer.appendChild(progressBarLabel);
        this.progressContainer.appendChild(this.progressBar);

        // Meter element container (initially hidden)
        this.meterContainer = document.createElement('div');
        this.meterContainer.className = 'mhc-meter-container';
        this.meterContainer.style.display = 'Block';

        // Creating a label for the meter
        const meterLabel = document.createElement('span');
        meterLabel.className = 'mhc-visually-hidden';
        meterLabel.id = 'mhc-meter-label';
        meterLabel.textContent = 'AI analysis progress';

        this.meterElement = document.createElement('div');
        this.meterElement.className = 'mhc-meter';
        this.meterElement.setAttribute('role', 'meter');
        this.meterElement.setAttribute('aria-valuemin', '0');
        this.meterElement.setAttribute('aria-valuemax', '100');
        this.meterElement.setAttribute('aria-valuenow', '0');
        this.meterElement.setAttribute('aria-labelledby', 'mhc-meter-label');

        this.meterLabelText = document.createElement('div');
        this.meterLabelText.className = 'mhc-meter-label';
        this.meterLabelText.textContent = 'Choose one of the following Quick Messages to get started or type what you need.';
        this.meterLabelText.setAttribute('aria-live', 'polite');
        this.meterLabelText.id = 'mhc-instructions';

        this.meterContainer.appendChild(meterLabel);
        this.meterContainer.appendChild(this.meterElement);
        this.meterContainer.appendChild(this.meterLabelText);

        // Perbaikan keyboard navigation
        this.setKeyboardNavigation = () => {
          const menuItems = this.quickReplies.querySelectorAll('[role="menuitem"]');

          // Atur tabindex pertama ke 0
          if (menuItems.length > 0) {
            menuItems[0].setAttribute('tabindex', '0');
          }

          menuItems.forEach((item, index) => {
            item.addEventListener('keydown', (e) => {
              if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                e.preventDefault();
                menuItems[index].setAttribute('tabindex', '-1');
                const nextIndex = (index + 1) % menuItems.length;
                menuItems[nextIndex].setAttribute('tabindex', '0');
                menuItems[nextIndex].focus();
              } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                e.preventDefault();
                menuItems[index].setAttribute('tabindex', '-1');
                const prevIndex = (index - 1 + menuItems.length) % menuItems.length;
                menuItems[prevIndex].setAttribute('tabindex', '0');
                menuItems[prevIndex].focus();
              } else if (e.key === 'Home') {
                e.preventDefault();
                menuItems[index].setAttribute('tabindex', '-1');
                menuItems[0].setAttribute('tabindex', '0');
                menuItems[0].focus();
              } else if (e.key === 'End') {
                e.preventDefault();
                menuItems[index].setAttribute('tabindex', '-1');
                menuItems[menuItems.length - 1].setAttribute('tabindex', '0');
                menuItems[menuItems.length - 1].focus();
              } else if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                item.click();
              }
            });

            item.addEventListener('click', () => {
              // Pastikan fokus kembali ke menu item setelah aksi
              item.focus();
            });
          });
        };
        // Assemble the container
        this.chatContainer.appendChild(this.header);
        this.chatContainer.appendChild(this.messageArea);
        this.chatContainer.appendChild(this.progressContainer);
        this.chatContainer.appendChild(this.meterContainer);
        this.chatContainer.appendChild(this.quickReplies);
        this.chatContainer.appendChild(this.inputContainer);

        // Initialize keyboard navigation after elements are added to DOM
        setTimeout(() => this.setKeyboardNavigation(), 0);

        document.body.appendChild(this.chatContainer);

        // Set desktop position if not mobile
        if (!this.isMobile) {
          this.chatContainer.classList.add('desktop');
          // For desktop, we start in partial state
          this.transitionTo(this.states.PARTIAL);
        }

        // Add initial greeting after a short delay
        setTimeout(() => {
          this.addBotMessage("Hello! I'm your Mental Health Assistant. How can I help you today?");
          // On mobile, transition to PARTIAL view after initial message
          if (this.isMobile) {
            this.transitionTo(this.states.PARTIAL);
          }
        }, 1000);
      }

      setupEventListeners() {
        // Send message on button click or Enter key
        this.sendButton.addEventListener('click', () => this.handleSend());
        this.inputField.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault(); // Tambahkan ini untuk mencegah perilaku default
            this.handleSend();
          }
        });

        // Quick reply buttons
        this.quickReplies.querySelectorAll('.mhc-quick-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const topic = e.target.dataset.topic;
            this.addUserMessage(topic.replace('_', ' '));
            this.processMessage(topic);
          });
        });

        // Only set up swipe handling on mobile
        if (this.isMobile) {
          this.setupSwipeHandling();
        }

        // Click header to toggle between partial and expanded (both mobile and desktop)
        this.header.addEventListener('click', () => {
          if (this.currentState === this.states.PARTIAL) {
            this.transitionTo(this.states.EXPANDED);
            this.body.style.overflow = 'hidden';
          } else if (this.currentState === this.states.EXPANDED) {
            this.transitionTo(this.states.PARTIAL);
            this.body.style.overflow = '';
          } else if (this.currentState === this.states.MINIMIZED) {
            this.transitionTo(this.states.PARTIAL);
            this.body.style.overflow = '';
          }
        });

        // Prevent window resizing from breaking the layout
        window.addEventListener('resize', () => {
          const wasMobile = this.isMobile;
          this.isMobile = window.innerWidth <= 768;

          // Handle transition between mobile and desktop
          if (wasMobile !== this.isMobile) {
            if (this.isMobile) {
              this.chatContainer.classList.remove('desktop');
              if (this.currentState === this.states.MINIMIZED) {
                // Keep minimized state on mobile
              } else {
                this.transitionTo(this.states.PARTIAL);
              }
              if (this.currentState === this.states.EXPANDED) {
                this.body.style.overflow = 'hidden';
              } else {
                this.body.style.overflow = 'auto';
              }
            } else {
              this.chatContainer.classList.add('desktop');
              this.transitionTo(this.states.PARTIAL);
            }
          }
        });
      }

      setupSwipeHandling() {
        let startY, currentY;
        let touchStartTime;
        const swipeHandle = this.header.querySelector('.mhc-swipe-handle');
        const header = this.header;

        const handleTouchStart = (e) => {
          startY = e.touches[0].clientY;
          touchStartTime = new Date().getTime();
        };

        const handleTouchMove = (e) => {
          if (!startY) return;
          currentY = e.touches[0].clientY;
          const diff = currentY - startY;

          // Prevent default browser behavior to allow smooth swipe
          e.preventDefault();

          // Add visual feedback during swipe
          if (diff > 0 && this.currentState !== this.states.MINIMIZED) {
            // Swiping down - show a subtle pull effect
            this.chatContainer.style.transform = `translateY(${Math.min(diff * 0.3, 30)}px)`;
          } else if (diff < 0 && this.currentState !== this.states.EXPANDED) {
            // Swiping up - show a subtle push effect
            this.chatContainer.style.transform = `translateY(${Math.max(diff * 0.3, -30)}px)`;
          }
        };

        const handleTouchEnd = (e) => {
          if (!startY) return;
          const diff = currentY - startY;
          const touchEndTime = new Date().getTime();
          const swipeTime = touchEndTime - touchStartTime;
          const isQuickSwipe = swipeTime < 300;

          // Reset transform
          this.chatContainer.style.transform = '';

          // Handle different swipe directions based on current state
          if (this.currentState === this.states.PARTIAL) {
            if ((diff > 50) || (isQuickSwipe && diff > 20)) {
              // Swiping down from partial - minimize
              this.transitionTo(this.states.MINIMIZED);
            } else if ((diff < -50) || (isQuickSwipe && diff < -20)) {
              // Swiping up from partial - expand
              this.transitionTo(this.states.EXPANDED);
            }
          } else if (this.currentState === this.states.EXPANDED) {
            if ((diff > 50) || (isQuickSwipe && diff > 20)) {
              // Swiping down from expanded - return to partial
              this.transitionTo(this.states.PARTIAL);
            }
          } else if (this.currentState === this.states.MINIMIZED) {
            if ((diff < -50) || (isQuickSwipe && diff < -20)) {
              // Swiping up from minimized - return to partial
              this.transitionTo(this.states.PARTIAL);
            }
          }

          startY = null;
          currentY = null;
        };

        // Add touch event listeners to the swipe handle
        swipeHandle.addEventListener('touchstart', handleTouchStart, { passive: true });
        swipeHandle.addEventListener('touchmove', handleTouchMove, { passive: false });
        swipeHandle.addEventListener('touchend', handleTouchEnd, { passive: true });

        // Add touch event listeners to the header as well for better UX
        header.addEventListener('touchstart', handleTouchStart, { passive: true });
        header.addEventListener('touchmove', handleTouchMove, { passive: false });
        header.addEventListener('touchend', handleTouchEnd, { passive: true });
      }

      transitionTo(newState) {
        // Exit current state
        this.chatContainer.classList.remove(this.currentState);

        // Enter new state
        this.chatContainer.classList.add(newState);
        this.currentState = newState;

        // Special handling for each state
        if (newState === this.states.MINIMIZED) {
          this.messageArea.style.display = 'none';
          this.quickReplies.style.display = 'none';
          this.header.querySelector('h3').style.display = 'none';
        } else {
          this.messageArea.style.display = 'block';
          this.quickReplies.style.display = 'flex';
          this.header.querySelector('h3').style.display = 'block';

          if (newState === this.states.PARTIAL) {
            // Scroll to bottom of last message
            this.scrollToLastMessage();
            this.body.style.overflow = 'auto';
          } else if (newState === this.states.EXPANDED) {
            // Scroll to very bottom
            this.scrollToBottom();
            this.body.style.overflow = 'hidden';
          } else {
            this.body.style.overflow = 'auto';
          }
        }
      }

      handleSend() {
        // Ambil teks dengan cara yang aksesibel
        const message = this.inputField.innerText.trim();

        if (message && message !== this.inputField.dataset.placeholder) {
          this.addUserMessage(message);
          this.inputField.innerHTML = '';

          // Atur ulang ARIA attributes
          this.inputField.setAttribute('aria-live', 'polite');
          this.inputField.setAttribute('aria-atomic', 'true');

          // Update live region
          if (this.liveRegion) {
            this.liveRegion.textContent = `Message sent: ${message}`;
          }

          // Disable input while processing
          this.inputField.setAttribute('contenteditable', 'false');
          this.sendButton.disabled = true;

          // Show progress bar
          this.showProgressBar();

          // Process message after a short delay to simulate sending
          setTimeout(() => {
            this.hideProgressBar();
            this.showMeter();
            this.processMessage(message);

            // Re-enable input
            this.inputField.setAttribute('contenteditable', 'true');
            this.sendButton.disabled = false;
            this.inputField.focus();
          }, 1500);

          // If minimized, transition to partial after sending
          if (this.currentState === this.states.MINIMIZED) {
            this.transitionTo(this.states.PARTIAL);
          }
        }
      }

      showProgressBar() {
        this.progressContainer.style.display = 'block';
        let progress = 0;
        const interval = setInterval(() => {
          progress += 5;
          this.progressBar.style.width = `${progress}%`;
          this.progressBar.setAttribute('aria-valuenow', progress);

          if (progress >= 100) {
            clearInterval(interval);
          }
        }, 50);
      }

      hideProgressBar() {
        this.progressContainer.style.display = 'none';
        this.progressBar.style.width = '0%';
        this.progressBar.setAttribute('aria-valuenow', '0');
      }

      showMeter() {
        this.meterContainer.style.display = 'block';
        let progress = 0;
        const interval = setInterval(() => {
          progress += 2;
          this.meterElement.style.width = `${progress}%`;
          this.meterElement.setAttribute('aria-valuenow', progress);

          if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              this.meterContainer.style.display = 'none';
              this.meterElement.style.width = '0%';
              this.meterElement.setAttribute('aria-valuenow', '0');
            }, 500);
          }
        }, 50);
      }

      addUserMessage(text) {
        const message = document.createElement('div');
        message.className = 'mhc-message user-message';
        message.textContent = text;
        message.setAttribute('aria-label', `You said: ${text}`);
        this.messageArea.appendChild(message);
        this.scrollToBottom();
      }

      addBotMessage(text) {
        const message = document.createElement('div');
        message.className = 'mhc-message bot-message';
        message.setAttribute('aria-label', `Assistant says: ${text}`);

        // Check if the text contains a URL
        const urlRegex = /(https?:\/\/[^\s]+)/g;
        const urls = text.match(urlRegex);

        if (urls && urls.length > 0) {
          // If there's a URL, create an iframe container
          const url = urls[0];
          const nonUrlText = text.replace(urlRegex, '').trim();

          if (nonUrlText) {
            // Add the non-URL text first
            const textPart = document.createElement('div');
            textPart.textContent = nonUrlText;
            message.appendChild(textPart);
          }

          // Create iframe container
          const iframeContainer = document.createElement('div');
          iframeContainer.className = 'mhc-iframe-container';

          // Create pop-out button
          const popOutBtn = document.createElement('button');
          popOutBtn.className = 'mhc-pop-out-btn';
          popOutBtn.innerHTML = '&#x2197;'; // Arrow icon
          popOutBtn.setAttribute('aria-label', 'Open link in new tab');
          popOutBtn.setAttribute('title', 'Open in new tab');
          popOutBtn.addEventListener('click', () => {
            window.open(url, '_blank');
          });

          // Create iframe
          const iframe = document.createElement('iframe');
          iframe.src = url;
          iframe.title = 'Resource from Mental Health Assistant';
          iframe.setAttribute('aria-label', 'Embedded resource content');
          iframe.setAttribute('frameborder', '0');
          iframe.setAttribute('scrolling', 'no');
          iframe.setAttribute('allow', 'fullscreen');

          // Append elements
          iframeContainer.appendChild(iframe);
          iframeContainer.appendChild(popOutBtn);
          message.appendChild(iframeContainer);
        } else {
          // Regular text message
          message.textContent = text;
        }

        this.messageArea.appendChild(message);

        // Re-enable input after bot responds
        this.inputField.disabled = false;
        this.sendButton.disabled = false;
        this.inputField.focus();

        // After adding bot message, transition to partial view if minimized
        if (this.currentState === this.states.MINIMIZED && this.isMobile) {
          this.transitionTo(this.states.PARTIAL);
        } else {
          this.scrollToBottom();
        }
      }

      scrollToBottom() {
        setTimeout(() => {
          this.messageArea.scrollTop = this.messageArea.scrollHeight;
        }, 100);
      }

      scrollToLastMessage() {
        setTimeout(() => {
          const messages = this.messageArea.querySelectorAll('.mhc-message');
          if (messages.length > 0) {
            const lastMessage = messages[messages.length - 1];
            lastMessage.scrollIntoView({ behavior: 'smooth', block: 'end' });
          }
        }, 100);
      }

      processMessage(message) {
        const normalizedInput = message.toLowerCase()
          .replace(/-/g, ' ')
          .replace(/_/g, ' ')
          .trim();

        const prediction = this.model.predict(normalizedInput);

        if (prediction.category !== "unknown" && this.faqData[prediction.category]) {
          const faq = this.faqData[prediction.category];

          // Show responses with delay
          faq.responses.forEach((response, i) => {
            setTimeout(() => {
              this.addBotMessage(response);
            }, 800 * (i + 1));
          });

          // Show resources
          if (faq.resources) {
            setTimeout(() => {
              this.addBotMessage(`More resources: ${faq.resources}`);
            }, 800 * (faq.responses.length + 1));
          }

          // Integrate sensor data
          this.integrateSensorData(prediction.category);
        } else {
          setTimeout(() => {
            this.addBotMessage("I'm not sure I understand. Could you try asking about depression, anxiety, stress, or self-care?");
          }, 800);
        }
      }

      integrateSensorData(topic) {
        const heartRate = document.getElementById('heartRate')?.textContent || 'N/A';
        const bloodPressure = document.getElementById('bloodPressure')?.textContent || 'N/A/N/A';

        if ((heartRate !== 'N/A' || bloodPressure !== 'N/A/N/A') &&
          (topic === 'depression' || topic === 'anxiety' || topic === 'stress')) {
          setTimeout(() => {
            this.addBotMessage(`Your current metrics - Heart Rate: ${heartRate}, Blood Pressure: ${bloodPressure}`);
          }, 1500);
        }
      }
    }

    // Initialize the chatbot when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      const chatbot = new MentalHealthChatbot();
    });
  </script>
</body>

</html>
